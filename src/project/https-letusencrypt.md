# 让你的网站支持`HTTPS` 

在前端安全领域,一个绕不开的话题就是HTTP网络请求,发生在`网络请求`和`网络响应`这个环节的安全防护就需要前端同学重点考虑,接下来会介绍`HTTPS`的诸多好处以及如何部署一个自己的免费`HTTPS`证书,如何部署`HTTPS`证书就是本文想表达的东西.

先给一个`HTTP`的图感受一下来自浏览器的不友好表现 ,hhhh,如果你的网站不支持HTTPS那么会常弹出该网站不够安全的提示.
![HTTPS](/https/no_https.png)



## HTTPS的好处

* **模拟调试网络请求** (前端mock)

作为一名前端,我们在开发过程中总会使用到需要调用`HTTPS`接口的时候,譬如小程序开发工具中需要提供`HTTPS`的环境进行调试,又比如需要加密一个sign需要验证包含referer的多个参数合并加密成一个token的时候,自己部署一套真实`HTTPS`环境就成了顺其自然的事情.


* **加密通信内容** (防范数据窃听)

`HTTPS` 通过在客户端和服务器之间建立加密的连接，确保数据在传输过程中不被窃听。无论是用户输入的敏感信息（如用户名、密码、信用卡号等）还是其他重要数据，都以加密的形式传输，黑客通过网络监听工具譬如`fiddler` `proxyman` `charles` 拦截用户提交的登录信息也无法解密其中的内容。

* **完整性校验** (防止数据篡改)

`HTTPS` 使用数字签名和消息认证码等技术来确保数据的完整性。这意味着在数据传输过程中，如果数据被篡改，接收方可以检测到这种篡改并拒绝接收被篡改的数据。比如在电商网站中，用户提交的订单信息在传输过程中如果被黑客篡改，可能导致用户收到错误的商品或支付错误的金额。使用 `HTTPS` 可以防止这种情况的发生，确保订单信息的完整性。

* **身份验证** (抵御中间人攻击)

`HTTPS` 通过使用数字证书来验证服务器的身份。客户端在与服务器建立连接时，会验证服务器的证书是否由可信的证书颁发机构颁发，并且证书中的域名是否与访问的域名一致。如果验证不通过，客户端会发出警告或拒绝连接。中间人攻击通常是黑客在客户端和服务器之间插入自己，冒充服务器或客户端进行通信。使用 `HTTPS` 可以有效地抵御这种攻击，因为黑客无法伪造合法的数字证书。

* **安全标识** (增强用户信任)

浏览器会在地址栏中显示安全锁图标和 `HTTPS` 字样，向用户表明该网站是安全的。这可以增强用户对网站的信任度，对用户比较友好也有信任感。我们在访问网站时，如果看到安全锁图标和 "`HTTPS`" 字样，会更放心地在该网站上进行各种操作，不用担心输入敏感信息、进行在线交易时被抓包或数据被泄露等。

* **限制外部资源加载** (防范`XSS`的部分场景)

`HTTPS` 可以限制网站只能加载来自安全来源（即使用 `HTTPS` 的域名）的外部资源，如脚本、样式表、图片等。这可以防止攻击者通过注入恶意的外部资源来执行跨站脚本攻击。
例如，如果一个网站使用 HTTP 加载外部脚本，而攻击者可以控制这个脚本的来源，那么攻击者就可以在脚本中注入恶意代码，从而攻击访问该网站的用户。使用 `HTTPS` 后，浏览器会限制只能加载来自安全来源的脚本，从而降低了这种攻击的风险。


## `HTTPS`证书在哪里找 

选择证书颁发机构（CA）
有许多商业和免费的 CA 可供选择。一些知名的商业 CA 包括 DigiCert、Symantec 等。对于个人网站或小型项目，也可以考虑使用免费的 CA，如 Let's Encrypt。

1. 企业级别网站,有预算且需要多个(2个以上)的网站进行商业性质的使用,可以购买标准的域名证书
2. 个人级别网站,预算少,开发测试足够用,用户访问量不是特别大

### 阿里云购买免费证书
默认有一年的免费域名证书 一般是赛门铁克签发的 也可以自己签发 

![HTTPS](/https/aliyun_ssl.jpg)



### 宝塔界面配置


> 方法一: Let's Encrypt  每三个月续签一次

![HTTPS](/https/ssl_bt_1.jpg)

> 方法二: 宝塔SSL 每个域名免费一年  但是需要登录宝塔账号对已部署的宝塔运维界面账号进行绑定 ,或者上述阿里云上购买

![HTTPS](/https/ssl_bt_2.jpg)



## 配置证书流程
> 如果不打算购买收/免费类型证书,自己签发也是可以的,就是下面步骤


::: tip 配置证书流程
生成证书签名请求（CSR） -> 申请证书 -> 部署证书
:::
### 1 生成证书签名请求（CSR）

选择证书颁发机构（CA）
有许多商业和免费的 CA 可供选择。一些知名的商业 CA 包括 DigiCert、Symantec 等。对于个人网站或小型项目，也可以考虑使用免费的 CA，如 Let's Encrypt。
不同的 CA 可能有不同的证书类型、验证级别和价格。根据你的需求选择合适的 CA。

生成 CSR
CSR 是一个包含你的网站信息的文件，用于向 CA 申请证书。你可以使用 OpenSSL 等工具生成 CSR。
运行命令生成私钥(注意当前目录)：
```sh
openssl genrsa 2048 > private.key。
```
这将生成一个 2048 位的 RSA 私钥，并保存为private.key文件。

运行以下命令生成 CSR：
```sh
openssl req -new -key private.key -out csr.csr
```
这将提示你输入一些网站信息，如国家、省份、城市、组织名称、通用名称等。通用名称应该是你的网站的域名。生成的 CSR 将保存为csr.csr文件。


### 2 申请证书
* 提交 CSR 给 CA
根据你选择的 CA 的要求，将生成的 CSR 提交给他们。不同的 CA 可能有不同的提交方式，通常可以通过在线表单、电子邮件或 API 进行提交。

* 验证域名所有权
CA 会验证你对申请证书的域名的所有权。验证方式可能包括以下几种：
DNS 验证：CA 会要求你在域名的 DNS 记录中添加一个特定的 TXT 记录，以证明你拥有该域名。
文件验证：CA 会要求你在网站的根目录下放置一个特定的文件，以证明你拥有该域名。
电子邮件验证：CA 会向域名的管理员邮箱发送一封验证邮件，你需要点击邮件中的链接进行验证。

* 获得证书
一旦 CA 验证通过你的域名所有权，他们将颁发证书。证书通常以 X.509 格式提供，包含你的网站的公钥、域名、有效期等信息。你可以从 CA 的网站上下载证书，通常是一个.crt或.pem文件。



::: tip 只部署
如果已经具备证书了,只需要看步骤3,4部署证书,配置pem即可
:::
### 3 部署证书 (选一个部署即可)

Apache：将证书文件（.crt或.pem）和私钥文件（.key）复制到服务器的特定目录中并配置：

```nginx
    SSLCertificateFile /path/to/certificate.crt
    SSLCertificateKeyFile /path/to/private.key
```    

Nginx：将证书文件和私钥文件复制到服务器的特定目录中并配置：
```nginx
    ssl_certificate /path/to/certificate.crt;
    ssl_certificate_key /path/to/private.key;
```

除了安装证书，建议开启强制`HTTPS`,这样用户只需要输入网址(xxx.com)就会默认跳转:
强制 `HTTPS`：可以通过配置服务器的重定向规则，将所有的 HTTP 请求重定向到 `HTTPS`。
* Nginx 中，可以使用rewrite指令进行重定向。
* 也可以使用宝塔进行可视化界面设置.


### 4 配置PEM密钥
什么是 PEM 密钥
PEM（Privacy Enhanced Mail）是一种用于存储证书和密钥的格式。它通常以.pem为文件扩展名，可以包含证书、私钥或两者的组合。
配置 PEM 密钥
如果你的服务器需要使用 PEM 密钥文件，可以将证书和私钥合并到一个 PEM 文件中。使用以下命令可以将证书和私钥合并到一个 PEM 文件中：

`Apache` 或者 `nginx` 的nginx.conf

均要设置对443端口 的使用
![HTTPS](/https/ssl_bt_3.jpg)

以apache为例: 拿到的pem证书文件需要先放置到你自己网站的某个地方 .然后在ssl_certificate 和 ssl_certificate_key 进行文件地址的匹配.
```sh
#  relaxto.com 替换自己的域名
ssl_certificate    /www/server/panel/vhost/cert/relaxto.com/fullchain.pem;
ssl_certificate_key    /www/server/panel/vhost/cert/relaxto.com/privkey.pem;
```

到这一步就算配置完了,此时访问自己的网站如果默认https就成功了. 希望这篇文章能帮到你 ~

## 参考链接
* [阿里云服务器](https://www.aliyun.com/daily-act/ecs/activity_selection?userCode=n62kgk7d)
* [阿里云SSL证书介绍页](https://www.aliyun.com/product/cas)
* [宝塔可视化面板](https://www.bt.cn/u/uunbwB)
